<!DOCTYPE html>
<html lang="id">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Memory Match — Periodic Elements (AI Adaptive, Full Table)</title>
        <style>
            :root {
                --bg: #0f1724;
                --card: #e6eef8;
                --accent: #60a5fa;
            }
            * {
                box-sizing: border-box;
                font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, "Helvetica Neue", Arial;
            }
            body {
                margin: 0;
                min-height: 100vh;
                background: linear-gradient(180deg, #071029 0%, #092033 100%);
                color: var(--card);
                display: flex;
                align-items: flex-start;
                justify-content: center;
                padding: 28px;
            }
            .app {
                width: 1100px;
                max-width: 96%;
                background: rgba(255, 255, 255, 0.03);
                border-radius: 12px;
                padding: 18px;
                box-shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
            }
            header {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 12px;
            }
            h1 {
                font-size: 18px;
                margin: 0;
                color: #dbeafe;
            }
            .controls {
                margin-left: auto;
                display: flex;
                gap: 8px;
                align-items: center;
            }
            select,
            button {
                padding: 8px 10px;
                border-radius: 8px;
                border: 0;
                background: rgba(255, 255, 255, 0.06);
                color: var(--card);
                cursor: pointer;
            }
            .meta {
                display: flex;
                gap: 12px;
                margin: 10px 0 8px;
            }
            .meta div {
                background: rgba(255, 255, 255, 0.03);
                padding: 8px 10px;
                border-radius: 8px;
                font-size: 14px;
            }
            #ai-feedback {
                color: #ffe66d;
                font-style: italic;
                margin: 8px 0;
                text-align: center;
            }
            .board {
                display: grid;
                gap: 10px;
                justify-items: stretch;
            }
            .card {
                width: 100%;
                aspect-ratio: 3/4;
                perspective: 1000px;
            }
            .card-inner {
                position: relative;
                width: 100%;
                height: 100%;
                transform-style: preserve-3d;
                transition: transform 0.45s cubic-bezier(0.2, 0.9, 0.3, 1);
            }
            .card.flipped .card-inner {
                transform: rotateY(180deg);
            }
            .face {
                position: absolute;
                inset: 0;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                backface-visibility: hidden;
                padding: 10px;
            }
            .front {
                background: linear-gradient(180deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.02));
                border: 1px dashed rgba(255, 255, 255, 0.03);
                color: #dbeafe;
            }
            .back {
                background: linear-gradient(180deg, var(--accent), #2563eb);
                color: white;
                transform: rotateY(180deg);
            }
            .symbol {
                font-weight: 700;
                font-size: 22px;
            }
            .name {
                font-size: 13px;
                text-align: center;
            }
            .hint {
                font-size: 11px;
                opacity: 0.95;
            }
            footer {
                margin-top: 14px;
                color: #cbd5e1;
                font-size: 13px;
            }
            .small {
                font-size: 12px;
                opacity: 0.9;
            }
            @media (min-width: 900px) {
                .board.cols-4 {
                    grid-template-columns: repeat(4, 1fr);
                }
                .board.cols-6 {
                    grid-template-columns: repeat(6, 1fr);
                }
                .board.cols-8 {
                    grid-template-columns: repeat(8, 1fr);
                }
                .board.cols-10 {
                    grid-template-columns: repeat(10, 1fr);
                }
            }
            @media (max-width: 899px) {
                .board {
                    grid-template-columns: repeat(2, 1fr);
                }
            }
        </style>
    </head>
    <body>
        <div class="app" role="application">
            <header>
                <div>
                    <h1>Memory Match — Periodic Elements (AI Adaptive, Full Table)</h1>
                    <div class="small">Mode: All-unsur tersedia. AI akan menyesuaikan jumlah pasangan (DDA) agar pembelajaran tetap efektif.</div>
                </div>
                <div class="controls">
                    <label class="small" for="mode">Mode</label>
                    <select id="mode">
                        <option value="all">All (progressive)</option>
                        <option value="grouped">Per Golongan</option>
                    </select>
                    <select id="groupSelect" style="display: none;"></select>
                    <button id="startBtn">Mulai / Reset</button>
                </div>
            </header>

            <div class="meta">
                <div>Level: <span id="level">1</span></div>
                <div>Moves: <span id="moves">0</span></div>
                <div>Matched: <span id="matched">0</span>/<span id="totalPairs">0</span></div>
                <div>Waktu: <span id="time">00:00</span></div>
            </div>

            <div id="ai-feedback">AI: Memantau performa kamu...</div>

            <main>
                <div id="board" class="board cols-6" aria-live="polite"></div>
            </main>

            <footer>
                <div class="small">Petunjuk: Klik kartu untuk membalik. Jika kesulitan, tunggu AI menyesuaikan level. Mode "All" akan menampilkan subset unsur yang meningkat seiring level (agar tidak menampilkan 236 kartu sekaligus).</div>
            </footer>
        </div>

        <script>
            // === Data: Semua 118 unsur (symbol + name + groupNumber + category) ===
            const PERIODIC_ELEMENTS = [
                { z: 1, symbol: "H", name: "Hidrogen", group: 1, category: "Nonmetal" },
                { z: 2, symbol: "He", name: "Helium", group: 18, category: "Noble gas" },
                { z: 3, symbol: "Li", name: "Litium", group: 1, category: "Alkali metal" },
                { z: 4, symbol: "Be", name: "Berilium", group: 2, category: "Alkaline earth" },
                { z: 5, symbol: "B", name: "Boron", group: 13, category: "Metalloid" },
                { z: 6, symbol: "C", name: "Karbon", group: 14, category: "Nonmetal" },
                { z: 7, symbol: "N", name: "Nitrogen", group: 15, category: "Nonmetal" },
                { z: 8, symbol: "O", name: "Oksigen", group: 16, category: "Nonmetal" },
                { z: 9, symbol: "F", name: "Fluorin", group: 17, category: "Halogen" },
                { z: 10, symbol: "Ne", name: "Neon", group: 18, category: "Noble gas" },
                { z: 11, symbol: "Na", name: "Natrium", group: 1, category: "Alkali metal" },
                { z: 12, symbol: "Mg", name: "Magnesium", group: 2, category: "Alkaline earth" },
                { z: 13, symbol: "Al", name: "Aluminium", group: 13, category: "Post-transition" },
                { z: 14, symbol: "Si", name: "Silikon", group: 14, category: "Metalloid" },
                { z: 15, symbol: "P", name: "Fosfor", group: 15, category: "Nonmetal" },
                { z: 16, symbol: "S", name: "Sulfur", group: 16, category: "Nonmetal" },
                { z: 17, symbol: "Cl", name: "Klorin", group: 17, category: "Halogen" },
                { z: 18, symbol: "Ar", name: "Argon", group: 18, category: "Noble gas" },
                { z: 19, symbol: "K", name: "Kalium", group: 1, category: "Alkali metal" },
                { z: 20, symbol: "Ca", name: "Kalsium", group: 2, category: "Alkaline earth" },
                { z: 21, symbol: "Sc", name: "Skandium", group: 3, category: "Transition metal" },
                { z: 22, symbol: "Ti", name: "Titanium", group: 4, category: "Transition metal" },
                { z: 23, symbol: "V", name: "Vanadium", group: 5, category: "Transition metal" },
                { z: 24, symbol: "Cr", name: "Kromium", group: 6, category: "Transition metal" },
                { z: 25, symbol: "Mn", name: "Mangan", group: 7, category: "Transition metal" },
                { z: 26, symbol: "Fe", name: "Besi", group: 8, category: "Transition metal" },
                { z: 27, symbol: "Co", name: "Kobalt", group: 9, category: "Transition metal" },
                { z: 28, symbol: "Ni", name: "Nikel", group: 10, category: "Transition metal" },
                { z: 29, symbol: "Cu", name: "Tembaga", group: 11, category: "Transition metal" },
                { z: 30, symbol: "Zn", name: "Seng", group: 12, category: "Transition metal" },
                { z: 31, symbol: "Ga", name: "Galium", group: 13, category: "Post-transition" },
                { z: 32, symbol: "Ge", name: "Germanium", group: 14, category: "Metalloid" },
                { z: 33, symbol: "As", name: "Arsen", group: 15, category: "Metalloid" },
                { z: 34, symbol: "Se", name: "Selenium", group: 16, category: "Nonmetal" },
                { z: 35, symbol: "Br", name: "Bromin", group: 17, category: "Halogen" },
                { z: 36, symbol: "Kr", name: "Krypton", group: 18, category: "Noble gas" },
                { z: 37, symbol: "Rb", name: "Rubidium", group: 1, category: "Alkali metal" },
                { z: 38, symbol: "Sr", name: "Stronsium", group: 2, category: "Alkaline earth" },
                { z: 39, symbol: "Y", name: "Itrium", group: 3, category: "Transition metal" },
                { z: 40, symbol: "Zr", name: "Zirkonium", group: 4, category: "Transition metal" },
                { z: 41, symbol: "Nb", name: "Niobium", group: 5, category: "Transition metal" },
                { z: 42, symbol: "Mo", name: "Molibdenum", group: 6, category: "Transition metal" },
                { z: 43, symbol: "Tc", name: "Teknetium", group: 7, category: "Transition metal" },
                { z: 44, symbol: "Ru", name: "Rutenium", group: 8, category: "Transition metal" },
                { z: 45, symbol: "Rh", name: "Rodium", group: 9, category: "Transition metal" },
                { z: 46, symbol: "Pd", name: "Paladium", group: 10, category: "Transition metal" },
                { z: 47, symbol: "Ag", name: "Perak", group: 11, category: "Transition metal" },
                { z: 48, symbol: "Cd", name: "Kadmium", group: 12, category: "Transition metal" },
                { z: 49, symbol: "In", name: "Indium", group: 13, category: "Post-transition" },
                { z: 50, symbol: "Sn", name: "Timah", group: 14, category: "Post-transition" },
                { z: 51, symbol: "Sb", name: "Antimon", group: 15, category: "Metalloid" },
                { z: 52, symbol: "Te", name: "Tellur", group: 16, category: "Metalloid" },
                { z: 53, symbol: "I", name: "Iodin", group: 17, category: "Halogen" },
                { z: 54, symbol: "Xe", name: "Xenon", group: 18, category: "Noble gas" },
                { z: 55, symbol: "Cs", name: "Sesium", group: 1, category: "Alkali metal" },
                { z: 56, symbol: "Ba", name: "Barium", group: 2, category: "Alkaline earth" },
                { z: 57, symbol: "La", name: "Lantanum", group: 3, category: "Lanthanide" },
                { z: 58, symbol: "Ce", name: "Serium", group: 3, category: "Lanthanide" },
                { z: 59, symbol: "Pr", name: "Praseodimium", group: 3, category: "Lanthanide" },
                { z: 60, symbol: "Nd", name: "Neodimium", group: 3, category: "Lanthanide" },
                { z: 61, symbol: "Pm", name: "Prometium", group: 3, category: "Lanthanide" },
                { z: 62, symbol: "Sm", name: "Samarium", group: 3, category: "Lanthanide" },
                { z: 63, symbol: "Eu", name: "Europium", group: 3, category: "Lanthanide" },
                { z: 64, symbol: "Gd", name: "Gadolinium", group: 3, category: "Lanthanide" },
                { z: 65, symbol: "Tb", name: "Terbium", group: 3, category: "Lanthanide" },
                { z: 66, symbol: "Dy", name: "Disprosium", group: 3, category: "Lanthanide" },
                { z: 67, symbol: "Ho", name: "Holmium", group: 3, category: "Lanthanide" },
                { z: 68, symbol: "Er", name: "Erbium", group: 3, category: "Lanthanide" },
                { z: 69, symbol: "Tm", name: "Thulium", group: 3, category: "Lanthanide" },
                { z: 70, symbol: "Yb", name: "Ytterbium", group: 3, category: "Lanthanide" },
                { z: 71, symbol: "Lu", name: "Lutetium", group: 3, category: "Lanthanide" },
                { z: 72, symbol: "Hf", name: "Hafnium", group: 4, category: "Transition metal" },
                { z: 73, symbol: "Ta", name: "Tantalum", group: 5, category: "Transition metal" },
                { z: 74, symbol: "W", name: "Tungsten", group: 6, category: "Transition metal" },
                { z: 75, symbol: "Re", name: "Rhenium", group: 7, category: "Transition metal" },
                { z: 76, symbol: "Os", name: "Osmium", group: 8, category: "Transition metal" },
                { z: 77, symbol: "Ir", name: "Iridium", group: 9, category: "Transition metal" },
                { z: 78, symbol: "Pt", name: "Platinum", group: 10, category: "Transition metal" },
                { z: 79, symbol: "Au", name: "Emas", group: 11, category: "Transition metal" },
                { z: 80, symbol: "Hg", name: "Raksa", group: 12, category: "Transition metal" },
                { z: 81, symbol: "Tl", name: "Timbal(III)", group: 13, category: "Post-transition" },
                { z: 82, symbol: "Pb", name: "Timbal", group: 14, category: "Post-transition" },
                { z: 83, symbol: "Bi", name: "Bismut", group: 15, category: "Post-transition" },
                { z: 84, symbol: "Po", name: "Polonium", group: 16, category: "Post-transition" },
                { z: 85, symbol: "At", name: "Astatin", group: 17, category: "Halogen" },
                { z: 86, symbol: "Rn", name: "Radon", group: 18, category: "Noble gas" },
                { z: 87, symbol: "Fr", name: "Francium", group: 1, category: "Alkali metal" },
                { z: 88, symbol: "Ra", name: "Radium", group: 2, category: "Alkaline earth" },
                { z: 89, symbol: "Ac", name: "Aktinium", group: 3, category: "Actinide" },
                { z: 90, symbol: "Th", name: "Torium", group: 3, category: "Actinide" },
                { z: 91, symbol: "Pa", name: "Protaktinium", group: 3, category: "Actinide" },
                { z: 92, symbol: "U", name: "Uranium", group: 3, category: "Actinide" },
                { z: 93, symbol: "Np", name: "Neptunium", group: 3, category: "Actinide" },
                { z: 94, symbol: "Pu", name: "Plutonium", group: 3, category: "Actinide" },
                { z: 95, symbol: "Am", name: "Amerisium", group: 3, category: "Actinide" },
                { z: 96, symbol: "Cm", name: "Kuriu", group: 3, category: "Actinide" },
                { z: 97, symbol: "Bk", name: "Berkelium", group: 3, category: "Actinide" },
                { z: 98, symbol: "Cf", name: "Kalifornium", group: 3, category: "Actinide" },
                { z: 99, symbol: "Es", name: "Einsteinium", group: 3, category: "Actinide" },
                { z: 100, symbol: "Fm", name: "Fermium", group: 3, category: "Actinide" },
                { z: 101, symbol: "Md", name: "Mendelevium", group: 3, category: "Actinide" },
                { z: 102, symbol: "No", name: "Nobelium", group: 3, category: "Actinide" },
                { z: 103, symbol: "Lr", name: "Lawrensium", group: 3, category: "Actinide" },
                { z: 104, symbol: "Rf", name: "Rutherfordium", group: 4, category: "Transition metal" },
                { z: 105, symbol: "Db", name: "Dubnium", group: 5, category: "Transition metal" },
                { z: 106, symbol: "Sg", name: "Seaborgium", group: 6, category: "Transition metal" },
                { z: 107, symbol: "Bh", name: "Bohrium", group: 7, category: "Transition metal" },
                { z: 108, symbol: "Hs", name: "Hassium", group: 8, category: "Transition metal" },
                { z: 109, symbol: "Mt", name: "Meitnerium", group: 9, category: "Unknown" },
                { z: 110, symbol: "Ds", name: "Darmstadtium", group: 10, category: "Unknown" },
                { z: 111, symbol: "Rg", name: "Roentgenium", group: 11, category: "Unknown" },
                { z: 112, symbol: "Cn", name: "Copernicium", group: 12, category: "Unknown" },
                { z: 113, symbol: "Nh", name: "Nihonium", group: 13, category: "Unknown" },
                { z: 114, symbol: "Fl", name: "Flerovium", group: 14, category: "Unknown" },
                { z: 115, symbol: "Mc", name: "Moscovium", group: 15, category: "Unknown" },
                { z: 116, symbol: "Lv", name: "Livermorium", group: 16, category: "Unknown" },
                { z: 117, symbol: "Ts", name: "Tennessine", group: 17, category: "Unknown" },
                { z: 118, symbol: "Og", name: "Oganesson", group: 18, category: "Unknown" },
            ];

            // App state
            let level = 1,
                moves = 0,
                matched = 0,
                totalPairs = 0,
                firstCard = null,
                secondCard = null,
                lockBoard = false;
            let timerInterval = null,
                seconds = 0;

            const boardEl = document.getElementById("board");
            const modeEl = document.getElementById("mode");
            const groupEl = document.getElementById("groupSelect");
            const startBtn = document.getElementById("startBtn");
            const levelEl = document.getElementById("level");
            const movesEl = document.getElementById("moves");
            const matchedEl = document.getElementById("matched");
            const totalPairsEl = document.getElementById("totalPairs");
            const timeEl = document.getElementById("time");
            const aiFeedback = document.getElementById("ai-feedback");

            // Build group listing for 'Per Golongan' mode (by category)
            const categories = Array.from(new Set(PERIODIC_ELEMENTS.map((e) => e.category))).sort();
            categories.unshift("All");
            categories.forEach((cat) => {
                const opt = document.createElement("option");
                opt.value = cat;
                opt.textContent = cat;
                groupEl.appendChild(opt);
            });

            modeEl.addEventListener("change", () => {
                if (modeEl.value === "grouped") groupEl.style.display = "inline-block";
                else groupEl.style.display = "none";
                startGame();
            });
            groupEl.addEventListener("change", startGame);

            function startGame() {
                resetState();
                // determine available elements based on mode
                let available = PERIODIC_ELEMENTS.slice();
                if (modeEl.value === "grouped" && groupEl.value && groupEl.value !== "All") {
                    available = PERIODIC_ELEMENTS.filter((e) => e.category === groupEl.value);
                }


                // DDA rule: choose number of pairs depending on level, but never exceed available
                // base_pairs increases per level: level1=6, level2=12, level3=20, etc. (progressive)

                // const base = 6;
                // const perLevel = 6;
                // const desiredPairs = Math.min(available.length, base + (level - 1) * perLevel);

                const base = 4;       // level 1 → 4 pasangan (8 kartu)
                const perLevel = 2;   // naik 2 pasangan per level
                const desiredPairs = Math.min(available.length, base + (level - 1) * perLevel);

                // const difficultyScale = Math.max(1, level);
                // const desiredPairs = Math.min(available.length, 4 + difficultyScale * 2);


                // build deck: for each selected element create 'name' and 'symbol' cards
                const selected = shuffle(available).slice(0, desiredPairs);
                const deck = [];
                selected.forEach((el) => {
                    deck.push({ uid: el.z + "-A", pairId: el.z, type: "name", content: el.name, symbol: el.symbol });
                    deck.push({ uid: el.z + "-B", pairId: el.z, type: "symbol", content: el.symbol, symbol: el.symbol });
                });

                totalPairs = desiredPairs;
                totalPairsEl.textContent = totalPairs;
                matchedEl.textContent = matched;
                const shuffledDeck = shuffle(deck);

                // set responsive grid columns by deck size
                const cols = Math.min(10, Math.max(4, Math.ceil(Math.sqrt(shuffledDeck.length))));
                boardEl.className = "board cols-" + cols;

                renderBoard(shuffledDeck);
                startTimer();
            }

            function renderBoard(deck) {
                boardEl.innerHTML = "";
                deck.forEach((card) => {
                    const wrapper = document.createElement("div");
                    wrapper.className = "card";
                    wrapper.dataset.uid = card.uid;
                    wrapper.dataset.pairId = card.pairId;
                    wrapper.innerHTML = `
          <div class="card-inner">
            <div class="face front small">?</div>
            <div class="face back">
              <div>
                <div class="symbol">${escapeHtml(card.type === "symbol" ? card.content : card.symbol)}</div>
                <div class="name">${escapeHtml(card.type === "name" ? card.content : card.type === "symbol" ? card.content : card.content)}</div>
                <div class="hint small">${escapeHtml(card.type === "name" ? "" : "Simbol")}</div>
              </div>
            </div>
          </div>`;
                    wrapper.addEventListener("click", () => onCardClick(wrapper));
                    boardEl.appendChild(wrapper);
                });
            }

            function onCardClick(wrapper) {
                if (lockBoard || wrapper.classList.contains("matched") || wrapper === firstCard) return;
                flip(wrapper);
                if (!firstCard) {
                    firstCard = wrapper;
                    return;
                }
                secondCard = wrapper;
                moves++;
                movesEl.textContent = moves;
                checkForMatch();
            }

            function checkForMatch() {
                const a = firstCard.dataset.pairId;
                const b = secondCard.dataset.pairId;
                if (a === b) {
                    firstCard.classList.add("matched");
                    secondCard.classList.add("matched");
                    matched++;
                    matchedEl.textContent = matched;
                    firstCard = null;
                    secondCard = null;
                    if (matched === totalPairs) winLevel();
                } else {
                    lockBoard = true;
                    setTimeout(() => {
                        unflip(firstCard);
                        unflip(secondCard);
                        firstCard = null;
                        secondCard = null;
                        lockBoard = false;
                    }, 700);
                }
            }

            function flip(el) {
                el.classList.add("flipped");
            }
            function unflip(el) {
                el.classList.remove("flipped");
            }

            function winLevel() {
                stopTimer();
                setTimeout(() => {
                    // show summary
                    const msg = `Selamat! Kamu menyelesaikan level ${level} dengan ${moves} langkah dan waktu ${formatTime(seconds)}.`;
                    // compute efficiency and let AI decide
                    applyAdaptiveAI();
                    // show short toast-like message (non-blocking)
                    aiFeedback.textContent = aiFeedback.textContent + " — " + msg;
                }, 200);
            }

            function applyAdaptiveAI() {
                // efficiency formula: matched pairs times factor over moves + time
                const efficiency = (matched * 10) / (Math.max(1, moves) + seconds / 10);
                let message = "";
                // adjust threshold adaptively based on board size
                if (efficiency > 3.5 && level < 10) {
                    level++;
                    message = "AI: Hebat! Aku naikkan level untuk tantangan lebih.";
                } else if (efficiency < 1.2 && level > 1) {
                    level--;
                    message = "AI: Tenang, aku turunkan level supaya lebih mudah.";
                } else {
                    message = "AI: Stabil — lanjutkan latihan.";
                }
                aiFeedback.textContent = message + ` (efisiensi: ${efficiency.toFixed(2)})`;
                levelEl.textContent = level;
                // small delay so player can read message, then start next
                setTimeout(startGame, 1200);
            }

            function resetState() {
                clearInterval(timerInterval);
                seconds = 0;
                timeEl.textContent = "00:00";
                firstCard = null;
                secondCard = null;
                lockBoard = false;
                moves = 0;
                matched = 0;
                movesEl.textContent = moves;
                matchedEl.textContent = matched;
                aiFeedback.textContent = "AI: Memantau performa kamu...";
            }

            function startTimer() {
                clearInterval(timerInterval);
                seconds = 0;
                timeEl.textContent = formatTime(seconds);
                timerInterval = setInterval(() => {
                    seconds++;
                    timeEl.textContent = formatTime(seconds);
                }, 1000);
            }
            function stopTimer() {
                clearInterval(timerInterval);
            }
            function formatTime(s) {
                const m = Math.floor(s / 60);
                const sec = s % 60;
                return `${String(m).padStart(2, "0")}:${String(sec).padStart(2, "0")}`;
            }

            function shuffle(a) {
                const arr = a.slice();
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            }
            function escapeHtml(t) {
                return String(t).replace(/[&<>\"]/g, (c) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c] || c));
            }

            startBtn.addEventListener("click", startGame);
            levelEl.textContent = level;
            // initial populate
            startGame();
        </script>
    </body>
</html>